{"version":3,"sources":["bem-blocks/form.js","01_main.js"],"names":["window","addEventListener","$form","document","querySelector","$nights","$nightsTo","$departCity","$country","$tourTableBody","$tourTableHead","$tourTitle","maxDate","changeDatePickerRange","minDate","inputAddError","target","message","value","setAttribute","classList","add","removeErrorClass","elem","remove","getZero","num","compareFn","a","b","price","days","millisec","t","Date","now","getDate","month","getMonth","year","getFullYear","getMillisecunds","selector","date","event","length","getElementById","setMinDate","e","preventDefault","formData","Object","fromEntries","FormData","entries","departCity","country","nights","nightsTo","async","res","fetch","json","getData","then","data","sort","tours","selectedCity","options","selectedIndex","innerText","selectedCountry","localDate","toLocaleDateString","day","replace","trim","innerHTML","forEach","tour","hotelName","currency","catch","err","Error","name","finally","reset"],"mappings":"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","file":"../js/main.min.js","sourcesContent":[null,"window.addEventListener(\"DOMContentLoaded\", () => {\r\n  const $form = document.querySelector(\"#form\");\r\n  const $nights = $form.querySelector(\"#nights\");\r\n  const $nightsTo = $form.querySelector(\"#nights-to\");\r\n  const $departCity = $form.querySelector(\"#depart-city\");\r\n  const $country = $form.querySelector(\"#country\");\r\n  const $tourTableBody = document.querySelector(\"#tourTableBody\");\r\n  const $tourTableHead = document.querySelector(\".tour-table thead\");\r\n  const $tourTitle = document.querySelector(\".tours__title\");\r\n  const maxDate = changeDatePickerRange(90);\r\n  const minDate = changeDatePickerRange(1);\r\n\r\n  const URL = \"https://ht.kz/test/searchPartner1\";\r\n\r\n  function inputAddError(target, message) {\r\n    target.value = \"\";\r\n    target.setAttribute(\"placeholder\", message);\r\n    target.classList.add(\"error\");\r\n  }\r\n\r\n  function removeErrorClass(elem) {\r\n    elem.classList.remove(\"error\");\r\n    elem.setAttribute(\"placeholder\", \"от 5 до 15\");\r\n  }\r\n\r\n  function getZero(num) {\r\n    if (num >= 0 && num < 10) {\r\n      return \"0\" + num;\r\n    } else {\r\n      return num;\r\n    }\r\n  }\r\n\r\n  function setMaxDate(selector, date) {\r\n    document.getElementById(selector).setAttribute(\"max\", date);\r\n  }\r\n  function setMinDate(selector, date) {\r\n    document.getElementById(selector).setAttribute(\"min\", date);\r\n  }\r\n\r\n  function getMillisecunds(days) {\r\n    const mil = 1000 * 60 * 60 * 24 * days;\r\n    return mil;\r\n  }\r\n\r\n  function compareFn(a, b) {\r\n    if (a.price > b.price) {\r\n      return 1;\r\n    }\r\n    if (a.price < b.price) {\r\n      return -1;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  const getData = async ({\r\n    departCity,\r\n    country,\r\n    date,\r\n    nights,\r\n    nightsTo,\r\n  } = {}) => {\r\n    const res = await fetch(\r\n      `${URL}?departCity=${departCity}&country=${country}&date=${date}&nights=${nights}&nightsTo=${nightsTo}`\r\n    );\r\n\r\n    return await res.json();\r\n  };\r\n\r\n  //  funtions nights input change\r\n\r\n  $nights.addEventListener(\"input\", (event) => {\r\n    const target = event.target;\r\n    if ($nightsTo.value.length > 0 && +$nightsTo.value <= +target.value) {\r\n      inputAddError(target, \"Больше чем до\");\r\n    } else if ($nightsTo.value > target.value) {\r\n      removeErrorClass(target);\r\n    }\r\n  });\r\n\r\n  $nightsTo.addEventListener(\"change\", (event) => {\r\n    const target = event.target;\r\n    if ($nights.value.length > 0 && +$nights.value >= +target.value) {\r\n      inputAddError(target, \"Меньше чем от\");\r\n    } else if (target.value > $nights.value) {\r\n      removeErrorClass(target);\r\n    }\r\n  });\r\n\r\n  /* ============= functions date picker =============== */\r\n\r\n  function changeDatePickerRange(days) {\r\n    const millesec = getMillisecunds(days);\r\n    const date = getDate(millesec);\r\n    return date;\r\n  }\r\n\r\n  function getDate(millisec) {\r\n    const t = Date.now() + millisec,\r\n      days = new Date(t).getDate(),\r\n      month = new Date(t).getMonth() + 1,\r\n      year = new Date(t).getFullYear();\r\n\r\n    const date = `${year}-${getZero(month)}-${getZero(days)}`;\r\n\r\n    return date;\r\n  }\r\n\r\n  setMaxDate(\"date-input\", maxDate);\r\n  setMinDate(\"date-input\", minDate);\r\n\r\n  // function createNode(element, className, message) {\r\n  //   const div = document.createElement(element);\r\n  //   div.classList.add(className);\r\n  //   div.textContent = message;\r\n  //   return div;\r\n  // }\r\n\r\n  // function append(parent, el) {\r\n  //   return parent.append(el);\r\n  // }\r\n\r\n  /* FORM GET */\r\n  $form.addEventListener(\"submit\", (e) => {\r\n    e.preventDefault();\r\n\r\n    const formData = Object.fromEntries(new FormData(e.target).entries());\r\n    const { departCity, country, date, nights, nightsTo } = formData;\r\n\r\n    getData({ departCity, country, date, nights, nightsTo })\r\n      .then((data) => {\r\n        const tours = data.tours;\r\n        const sort = tours.sort(compareFn);\r\n\r\n        let selectedCity =\r\n          $departCity[$departCity.options.selectedIndex].innerText;\r\n        let selectedCountry =\r\n          $country[$country.options.selectedIndex].innerText;\r\n        let localDate = new Date(date)\r\n          .toLocaleDateString(\"lookup\", {\r\n            year: \"numeric\",\r\n            month: \"long\",\r\n            day: \"numeric\",\r\n          })\r\n          .replace(/г.$/g, \"\")\r\n          .trim();\r\n\r\n        $tourTitle.innerHTML = `\r\n      <h2>\r\n        Результаты запроса (${selectedCity} -\r\n        ${selectedCountry},\r\n        ${localDate},\r\n        ${nights}-${nightsTo}н.):\r\n      </h2>\r\n      `;\r\n\r\n        $tourTableHead.innerHTML = `\r\n        <tr>\r\n          <th>Hotel name</th>\r\n          <th>price</th>\r\n          <th>currency</th>\r\n        </tr>\r\n      `;\r\n\r\n        sort.forEach((tour) => {\r\n          $tourTableBody.innerHTML += `\r\n        <tr>\r\n          <td>${tour.hotelName}</td>\r\n          <td>${tour.price}</td>\r\n          <td>${tour.currency}</td>\r\n        </tr>\r\n        `;\r\n\r\n          document.querySelector(\"#tours\").classList.add(\"tours\");\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        throw new Error(`${err.name} ${err.message}`);\r\n      })\r\n      .finally(() => {\r\n        e.target.reset();\r\n        removeErrorClass($nights);\r\n        removeErrorClass($nightsTo);\r\n      });\r\n  });\r\n\r\n  $departCity.addEventListener(\"change\", (e) => {\r\n    const target = e.target;\r\n    if (target && $departCity.value === \"10\") {\r\n      $country.innerHTML = `\r\n      <option value=\"\" disabled selected hidden>Страна</option>\r\n      <option value=\"552\">Турция</option>\r\n      <option value=\"553\">Тайланд</option>`;\r\n    } else if (target && $departCity.value === \"11\") {\r\n      $country.innerHTML = `\r\n      <option value=\"\" disabled selected hidden>Страна</option>\r\n      <option value=\"552\">Турция</option>\r\n      <option value=\"554\">Чехия</option>`;\r\n    } else {\r\n      $country.innerHTML = `\r\n      <option value=\"\" disabled selected hidden>Страна</option>\r\n      <option>Страна</option>\r\n      `;\r\n    }\r\n  });\r\n});\r\n"]}